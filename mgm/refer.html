<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Open App or Redirect to Store</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        padding: 50px;
      }

      h1 {
        color: #333;
      }

      p {
        font-size: 1.2em;
        color: #666;
      }
    </style>
  </head>
  <body>
    <h1>Redirecting...</h1>
    <p>If your app does not open automatically, <a id="fallback-link" href="#">click here</a> to install it. </p>
    <p>Email me at <a class="js-emaillink" href="mailto:chriscoyier@gmail.com">chriscoyier@gmail.com</a></p>
    <p><button class="js-emailcopybtn">Copy Email</button></p>
    <script>
      // Function to open the app or redirect to the store
      function getQueryParam(param) {
        var urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
      }

      function setCookie(cname,cvalue,exdays) {
          const d = new Date();
          d.setTime(d.getTime() + (exdays*24*60*60*1000));
          let expires = "expires=" + d.toUTCString();
          document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
      }

      function getCookie(cname) {
      let name = cname + "=";
      let decodedCookie = decodeURIComponent(document.cookie);
      let ca = decodedCookie.split(';');
      for(let i = 0; i < ca.length; i++) {
          let c = ca[i];
          while (c.charAt(0) == ' ') {
            c = c.substring(1);
          }
          if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length);
          }
      }
      return "";
    }

     window.Clipboard = (function(window, document, navigator) {
    var textArea,
        copy;

    function isOS() {
        return navigator.userAgent.match(/ipad|iphone/i);
    }

    function createTextArea(text) {
        textArea = document.createElement('textArea');
        textArea.value = text;
        document.body.appendChild(textArea);
    }

    function selectText() {
        var range,
            selection;

        if (isOS()) {
            range = document.createRange();
            range.selectNodeContents(textArea);
            selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            textArea.setSelectionRange(0, 999999);
        } else {
            textArea.select();
        }
    }

    function copyToClipboard() {        
        document.execCommand('copy');
        document.body.removeChild(textArea);
    }

    copy = function(text) {
        createTextArea(text);
        selectText();
        copyToClipboard();
    };

    return {
        copy: copy
    };
})(window, document, navigator);

      function copyChalao() {
        var copyEmailBtn = document.querySelector('.js-emailcopybtn');  
copyEmailBtn.addEventListener('click', function(event) {  
  // Select the email link anchor text  
  var emailLink = document.querySelector('.js-emaillink');  
  var range = document.createRange();  
  range.selectNode(emailLink);  
  window.getSelection().addRange(range);  

  try {  
    // Now that we've selected the anchor text, execute the copy command  
    var successful = document.execCommand('copy');  
    var msg = successful ? 'successful' : 'unsuccessful';  
    console.log('Copy email command was ' + msg);  
  } catch(err) {  
    console.log('Oops, unable to copy');  
  }  

  // Remove the selections - NOTE: Should use
  // removeRange(range) when it is supported  
  window.getSelection().removeAllRanges();  
});
      }

      function openAppOrRedirect() {
        var referralCode = getQueryParam("referralcode");
        var userAgent = navigator.userAgent || navigator.vendor || window.opera;
        // Check if the device is iOS
        if (/iPhone|iPad|iPod/i.test(userAgent)) {
          // Open the app using a custom URL scheme or redirect to the App Store
          //setCookie("referral", "2223344", 1);
          //alert("Copied!: "+getCookie("referral"));
          //Clipboard.copy('text to be copied');
          copyChalao();
        }
        // Check if the device is Android
        else if (/android/i.test(userAgent)) {
          // Open the app using a custom URL scheme or redirect to the Play Store
        //  window.location.href = 'intent://invite?referralCode=' + referralCode + '#Intent;scheme=com.adcb.cbgdigi;package=com.adcb.cbgdigi;end;'
          setTimeout(function() {
            //window.location.href = "https://play.google.com/store/apps/details?id=com.jjss.applinktest&hl=en&referrer=referralCode=" + referralCode;
            window.location.href = "https://play.google.com/store/apps/details?id=com.jjss.applinktest&referrer=referralCode%3D"+referralCode+"%26source%3DHayyakMobile"
          }, 2000);
        }
        // For other devices or if detection fails, fallback to a generic page or website
        else {
          document.getElementById("fallback-link").href = "https://www.adcb.com/en/personal/";
          window.location.href = "https://onlineadcbapps.adcb.com/apps/Hayyak/";
        }
      }
      // Example referral code, replace with dynamic code as needed
      // var referralCode = "47bb9168-f7dc-4d23-9d09-f6030829da0f";
      openAppOrRedirect();
    </script>
  </body>
</html>
